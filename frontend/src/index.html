<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸å®‰è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿ v3.0</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <style>
        .mt-3 { margin-top: 15px; } .mt-4 { margin-top: 20px; } .w-100 { width: 100%; }
        .text-muted { color: #888; font-size: 0.9em; }
        .panel { background: var(--card-bg, #fff); border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); padding: 20px; }
        .panel-header h2 { margin-top: 0; font-size: 1.2em; color: var(--primary-color, #333); border-bottom: 1px solid #eee; padding-bottom: 10px; }
    </style>
</head>
<body>
<div id="app">
    <aside class="sidebar">
        <div class="sidebar-header"><div class="logo"><span class="logo-icon">ğŸ“ˆ</span><span class="logo-text">äº¤æ˜“ç³»ç»Ÿ v3</span></div></div>
        <nav class="sidebar-nav">
            <a v-for="item in menuItems" :key="item.id" :class="{ active: currentView === item.id }" @click="currentView = item.id">
                <span class="nav-icon">{{ item.icon }}</span><span class="nav-text">{{ item.name }}</span>
            </a>
        </nav>
    </aside>
    
    <main class="main-content">
        <header class="top-bar">
            <h1>{{ currentViewTitle }}</h1>
            <div class="top-actions">
                <div class="balance-info"><span class="balance-label">è´¦æˆ·ä½™é¢</span><span class="balance-value">{{ formatBalance(accountBalance) }} USDT</span></div>
                <button class="btn btn-primary" @click="refreshData">ğŸ”„ åˆ·æ–°</button>
            </div>
        </header>
        
        <div class="content-area">
            <div v-if="currentView === 'dashboard'" class="view-dashboard">
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-icon">ğŸ’°</div><div class="stat-content"><div class="stat-value">{{ formatBalance(accountBalance) }}</div><div class="stat-label">è´¦æˆ·ä½™é¢</div></div></div>
                    <div class="stat-card"><div class="stat-icon">ğŸ“Š</div><div class="stat-content"><div class="stat-value" :class="dailyPnL >= 0 ? 'profit' : 'loss'">{{ dailyPnL >= 0 ? '+' : '' }}{{ formatBalance(dailyPnL) }}</div><div class="stat-label">ä»Šæ—¥ç›ˆäº</div></div></div>
                    <div class="stat-card"><div class="stat-icon">ğŸ“ˆ</div><div class="stat-content"><div class="stat-value">{{ winRate }}%</div><div class="stat-label">èƒœç‡</div></div></div>
                    <div class="stat-card"><div class="stat-icon">ğŸ“‰</div><div class="stat-content"><div class="stat-value">{{ maxDrawdown.toFixed(2) }}%</div><div class="stat-label">æœ€å¤§å›æ’¤</div></div></div>
                </div>

                <div class="panel mt-4">
                    <div class="panel-header"><h2>ğŸ“¡ ç›‘æ§è‡ªé€‰æ±  (å¤šå“ç§çƒ­æ’æ‹”é›·è¾¾)</h2></div>
                    <div class="panel-body mt-3">
                        <div class="symbol-input-group">
                            <input type="text" v-model="newSymbolInput" @keyup.enter="addSymbol" placeholder="è¾“å…¥å“ç§ (ä¾‹: DOGEUSDT)" />
                            <button class="btn btn-primary" @click="addSymbol" :disabled="isModifyingSymbol">{{ isModifyingSymbol ? 'æŒ‚è½½ä¸­...' : 'â• æŒ‚è½½ç›‘æ§' }}</button>
                        </div>
                        <div class="symbol-tags-container mt-3">
                            <div v-if="activeSymbols.length === 0" class="text-muted">å½“å‰æš‚æ— ç›‘æ§å“ç§ï¼Œç³»ç»Ÿå¤„äºç©ºè½¬çŠ¶æ€ã€‚</div>
                            <div v-for="sym in activeSymbols" :key="sym" class="symbol-tag">
                                ğŸ“¡ {{ sym }} <button class="remove-btn" title="å¼ºåˆ¶é˜»æ–­å¹¶å¸è½½" @click="removeSymbol(sym)">Ã—</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel mt-4">
                    <div class="panel-header"><h2>ğŸ’¼ å½“å‰å®æ—¶æŒä»“</h2></div>
                    <div class="panel-body" style="overflow-x: auto;">
                        <table class="data-table">
                            <thead><tr><th>å“ç§</th><th>æ–¹å‘</th><th>å¼€ä»“å‡ä»·</th><th>æ•°é‡</th><th>æ€»é¢(USDT)</th><th>ç­–ç•¥å½’å±</th></tr></thead>
                            <tbody>
                                <tr v-for="pos in positions" :key="pos.id">
                                    <td style="font-weight:bold;">{{ pos.symbol }}</td>
                                    <td :class="pos.side === 'BUY' ? 'profit' : 'loss'">{{ pos.side === 'BUY' ? 'åšå¤š (BUY)' : 'åšç©º (SELL)' }}</td>
                                    <td>{{ formatBalance(pos.entry_price) }}</td>
                                    <td>{{ pos.quantity }}</td>
                                    <td>{{ formatBalance(pos.entry_price * pos.quantity) }}</td>
                                    <td><span class="status-badge enabled">{{ pos.strategy || 'æ‰‹åŠ¨å¼€ç«' }}</span></td>
                                </tr>
                                <tr v-if="positions.length === 0"><td colspan="6" class="text-center text-muted">å½“å‰ç©ºä»“ç­‰å¾…æœºä¼š</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="panel mt-4">
                    <div class="panel-header"><h2>ğŸ“œ æœ€è¿‘äº¤æ˜“æµæ°´ (ç”±è¿‘åˆ°è¿œ)</h2></div>
                    <div class="panel-body" style="overflow-x: auto;">
                        <table class="data-table">
                            <thead><tr><th>æ—¶é—´</th><th>å“ç§</th><th>æ–¹å‘</th><th>æˆäº¤ä»·</th><th>æ•°é‡</th><th>ç›ˆäº(USDT)</th><th>çŠ¶æ€</th></tr></thead>
                            <tbody>
                                <tr v-for="t in trades" :key="t.id">
                                    <td class="text-muted">{{ t.entry_time ? t.entry_time.replace('T', ' ').substring(0, 19) : '-' }}</td>
                                    <td style="font-weight:bold;">{{ t.symbol }}</td>
                                    <td :class="t.side === 'BUY' ? 'profit' : 'loss'">{{ t.side }}</td>
                                    <td>{{ t.status === 'CLOSED' ? formatBalance(t.exit_price) : formatBalance(t.entry_price) }}</td>
                                    <td>{{ t.quantity }}</td>
                                    <td :class="t.pnl > 0 ? 'profit' : (t.pnl < 0 ? 'loss' : '')">
                                        {{ t.status === 'CLOSED' ? (t.pnl > 0 ? '+' : '') + formatBalance(t.pnl) : '-' }}
                                    </td>
                                    <td>
                                        <span class="status-badge" :class="t.status === 'CLOSED' ? 'disabled' : 'enabled'">
                                            {{ t.status === 'CLOSED' ? 'å·²å¹³ä»“' : 'æŒä»“ä¸­' }}
                                        </span>
                                    </td>
                                </tr>
                                <tr v-if="trades.length === 0"><td colspan="7" class="text-center text-muted">æš‚æ— äº¤æ˜“æµæ°´</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div v-if="currentView === 'strategy'" class="view-strategy">
                <div class="strategy-toolbar"><button class="btn btn-primary">â• æ·»åŠ ç­–ç•¥</button><button class="btn" @click="loadStrategies">ğŸ”„ åˆ·æ–°</button></div>
                <div class="strategy-grid mt-3">
                    <div v-for="s in strategies" :key="s.name" class="strategy-card">
                        <div class="strategy-header"><h3>{{ s.name }}</h3><span class="status-badge" :class="s.enabled ? 'enabled' : 'disabled'">{{ s.enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨' }}</span></div>
                        <div class="strategy-body">
                            <p>{{ s.description }}</p>

                            <div style="background: rgba(0,0,0,0.05); padding: 12px; border-radius: 6px; margin-top: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span class="text-muted">å†å²æ‰§è¡Œç¬”æ•°:</span>
                                    <strong style="font-size: 1.1em;">{{ getStrategyTrades(s.name).length }} ç¬”</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span class="text-muted">ç­–ç•¥ç´¯è®¡ç›ˆäº:</span>
                                    <strong style="font-size: 1.1em;" :class="getStrategyPnL(s.name) > 0 ? 'profit' : (getStrategyPnL(s.name) < 0 ? 'loss' : '')">
                                        {{ getStrategyPnL(s.name) > 0 ? '+' : '' }}{{ formatBalance(getStrategyPnL(s.name)) }} USDT
                                    </strong>
                                </div>
                            </div>
                            
                            <div class="mt-3" v-if="getStrategyTrades(s.name).length > 0">
                                <div style="font-size: 0.85em; color: #888; margin-bottom: 5px;">æœ€è¿‘å¼€ç«è®°å½•:</div>
                                <div v-for="t in getStrategyTrades(s.name).slice(0, 3)" :key="t.id" style="font-size: 0.85em; display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px dashed rgba(0,0,0,0.1);">
                                    <span class="text-muted">{{ t.entry_time.substring(5, 16).replace('T', ' ') }}</span>
                                    <span><span :class="t.side === 'BUY' ? 'profit' : 'loss'">{{ t.side }}</span> {{ t.symbol }}</span>
                                </div>
                            </div>
                            <div class="strategy-params-form mt-3" v-if="s.params && Object.keys(s.params).length > 0">
                                <div style="font-size:0.9em; font-weight:bold; margin-bottom:8px; color:#555;">âš™ï¸ è¿è¡Œæ—¶å‚æ•°è°ƒä¼˜</div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                    <div class="param-group" v-for="(val, key) in s.params" :key="key">
                                        <label>{{ key }}</label>
                                        <input type="number" step="any" v-model.number="s.params[key]">
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-success mt-3 w-100" @click="saveStrategyParams(s.name, s.params)">ğŸ’¾ ä¿å­˜å¹¶çƒ­æ›´æ–°å‚æ•°</button>
                            </div>
                        </div>
                        <div class="strategy-footer mt-3" style="border-top: 1px solid #eee; padding-top: 10px;">
                            <button class="btn btn-sm" :class="s.enabled ? 'btn-warning' : 'btn-success'" @click="toggleStrategy(s.name)">{{ s.enabled ? 'ğŸ›‘ åœç”¨å¼•æ“' : 'ğŸš€ å¯åŠ¨å¼•æ“' }}</button>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentView === 'backtest'" class="view-backtest">
                <div class="backtest-layout">
                    <div class="backtest-config">
                        <div class="config-card">
                            <h3>å›æµ‹é…ç½®</h3>
                            <div class="form-group"><label>ç­–ç•¥</label><select v-model="backtestConfig.strategy"><option v-for="s in strategies" :key="s.name" :value="s.name">{{ s.name }}</option></select></div>
                            <div class="form-group"><label>äº¤æ˜“å¯¹</label><select v-model="backtestConfig.symbol"><option value="BTCUSDT">BTC/USDT</option><option value="ETHUSDT">ETH/USDT</option></select></div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 16px;">
                                <div class="form-group" style="margin-bottom: 0;">
                                    <label>å¼€å§‹æ—¥æœŸ</label>
                                    <input type="date" v-model="backtestConfig.startTime">
                                </div>
                                <div class="form-group" style="margin-bottom: 0;">
                                    <label>ç»“æŸæ—¥æœŸ</label>
                                    <input type="date" v-model="backtestConfig.endTime">
                                </div>
                            </div>
                            <div class="form-group"><label>åˆå§‹èµ„é‡‘</label><input type="number" v-model="backtestConfig.initialCapital"></div>
                            <button class="btn btn-primary btn-block mt-3" @click="runBacktest" :disabled="backtestRunning">{{ backtestRunning ? 'è®¡ç®—å¼•æ“è½°é¸£ä¸­...' : 'ğŸš€ å¯åŠ¨å†å²å›æµ‹' }}</button>
                        </div>
                    </div>
                    <div class="backtest-results">
                        <div v-if="backtestResult" class="results-container">
                            <div class="performance-overview">
                                <div class="perf-card" :class="backtestResult.totalReturn >= 0 ? 'profit' : 'loss'"><div class="perf-value">{{ backtestResult.totalReturn.toFixed(2) }}%</div><div class="perf-label">æ€»æ”¶ç›Š</div></div>
                                <div class="perf-card"><div class="perf-value">{{ backtestResult.annualReturn.toFixed(2) }}%</div><div class="perf-label">å¹´åŒ–</div></div>
                                <div class="perf-card"><div class="perf-value">{{ backtestResult.maxDrawdown.toFixed(2) }}%</div><div class="perf-label">å›æ’¤</div></div>
                                <div class="perf-card"><div class="perf-value">{{ backtestResult.sharpeRatio.toFixed(2) }}</div><div class="perf-label">å¤æ™®</div></div>
                                <div class="perf-card"><div class="perf-value">{{ backtestResult.winRate.toFixed(2) }}%</div><div class="perf-label">èƒœç‡</div></div>
                                <div class="perf-card"><div class="perf-value">{{ backtestResult.profitFactor.toFixed(2) }}</div><div class="perf-label">ç›ˆäºæ¯”</div></div>
                            </div>
                        </div>
                        <div v-else class="empty-state"><div class="empty-icon">ğŸ“Š</div><p>é…ç½®å‚æ•°åç‚¹å‡»"å¯åŠ¨å†å²å›æµ‹"</p></div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
<script src="js/config.js"></script>
<script src="js/api.js"></script>
<script src="js/app.js"></script>
</body>
</html>